# 特許制度学習アプリ（動画プレイヤー版）

Django フレームワークを使用した特許制度インタラクティブ学習アプリケーション。**動画プレイヤー**とAIチャットボットが連携して、視覚的で効率的な学習体験を提供します。

## 🎯 主要機能

### 🎮 動画プレイヤーシステム（左側2分割）

#### 🎵 波形コントローラー（左上）
- **Wavesurfer.js 6.6.4** による美しい波形表示
- ドラッグによる再生区間指定・ハイライト表示
- 高度な区間ループ再生機能
- 分離された再生ボタンと一時停止・再開ボタン
- ポインタ位置ベースの直感的操作
- 美しい時間表示（グリッドレイアウト）

#### 🎥 動画表示エリア（左下）
- **HTML5 Video** による高品質動画再生
- 波形コントローラーとの**完全同期**
- シーク・再生・停止操作の即座反映
- クリーンな動画表示（統合制御）

### 💬 AIチャットボット（右側）
- **Dify API** 連携による特許制度Q&A
- 回答に含まれる時間情報の自動解析（1-2桁分対応）
- 動画プレイヤーとの完璧な自動連携
- 左右配置の美しいチャットUI
- ローディングアニメーション

### 🔗 連携機能
- チャット回答の時間情報を動画区間に自動反映
- 複数質問での区間自動更新
- 自動シーク・ハイライト機能（動画も連動）
- リアルタイム時間表示更新

### 🎨 モダンデザイン
- **CSS変数による統一デザインシステム**
- **2x2グリッドレイアウト**（CSS Grid）
- **レスポンシブデザイン完全対応**
- **美しいカードデザイン**（シャドウ・角丸）
- **ホバーエフェクト・アニメーション**
- **統一されたカラーパレット**

## 🚀 セットアップ手順

### 1. リポジトリのクローン
```bash
git clone https://github.com/tinyoko/patentlec.git
cd patentlec
```

### 2. Python仮想環境の作成とアクティベート
```bash
python -m venv venv

# macOS/Linux
source venv/bin/activate

# Windows
venv\\Scripts\\activate
```

### 3. 依存関係のインストール
```bash
pip install -r requirements.txt
```

### 4. 環境変数の設定
```bash
# .env.example をコピーして .env ファイルを作成
cp .env.example .env

# .env ファイルを編集して必要な設定を入力
```

**.env** ファイルの設定例：
```env
# Django設定
SECRET_KEY=your-secret-key-here
DEBUG=True

# Dify API設定
DIFY_API_URL=https://djartipy.com/v1/workflows/run
DIFY_API_KEY=your-dify-api-key-here

# データベース設定
DATABASE_URL=sqlite:///db.sqlite3
```

### 5. 動画ファイルの配置
講義動画ファイル（`lecture.mp4`）を以下の場所に配置してください：
```
chat_app/static/chat_app/lecture.mp4
```

### 6. データベースのマイグレーション
```bash
python manage.py migrate
```

### 7. 開発サーバーの起動
```bash
python manage.py runserver 127.0.0.1:8001
```

アプリケーションは http://127.0.0.1:8001/ でアクセスできます。

## 📁 プロジェクト構成

```
django_dify_chat/
├── manage.py                    # Django管理コマンド
├── requirements.txt             # Python依存関係
├── .env                        # 環境変数（要設定）
├── .env.example               # 環境変数テンプレート
├── .gitignore                 # Git除外ファイル
├── README.md                  # このファイル
├── django_dify_chat/          # Djangoプロジェクト設定
│   ├── settings.py           # Django設定
│   ├── urls.py              # URLルーティング
│   └── wsgi.py              # WSGIアプリケーション
└── chat_app/                  # メインアプリケーション
    ├── views.py              # ビューロジック
    ├── urls.py              # アプリURLs
    ├── static/chat_app/     # 静的ファイル
    │   ├── main.js         # JavaScript（動画同期機能）
    │   ├── styles.css      # スタイルシート
    │   └── lecture.mp4     # 動画ファイル（要配置）
    └── templates/chat_app/  # テンプレート
        └── index.html      # メインページ
```

## 🛠 技術仕様

### バックエンド
- **Django 5.2.5** - Webフレームワーク
- **Python 3.13** - プログラミング言語
- **SQLite** - データベース（開発環境）
- **python-dotenv 1.1.1** - 環境変数管理

### フロントエンド
- **Wavesurfer.js 6.6.4** - 音声波形可視化・制御
- **HTML5 Video** - 動画表示・同期
- **Vanilla JavaScript** - 動画同期ロジック
- **CSS3** - モダンデザインシステム
- **CSS Grid & Flexbox** - レスポンシブレイアウト

### API・セキュリティ
- **Dify API** - AIチャットボット機能
- **requests** - HTTP通信
- **環境変数管理** - APIキーの安全な管理
- **CSRF対応** - セキュリティ強化

## 🎮 操作方法

### 動画プレイヤー操作

**再生ボタン（青色）**：
- ポインタがリージョン内: リージョン最初から再生
- ポインタがリージョン外/なし: 動画先頭から再生

**一時停止・再開ボタン（赤色）**：
- 再生中: 現在位置で一時停止
- 停止中: 現在位置から再生再開

**リージョン（区間）操作**：
- ドラッグで区間選択
- クリックでシーク（再生状態維持）
- ループ再生チェックボックスで区間ループ

**時間表示**：
- 美しいグリッドレイアウト
- リアルタイム更新
- モノスペースフォントで見やすく表示

### チャットボット操作
1. 右側の入力欄に特許制度に関する質問を入力
2. **「送信」ボタン（緑色グラデーション）** またはEnterキーで送信
3. AI回答に時間情報が含まれる場合、自動的に動画プレイヤーに区間が作成される（動画表示も連動）
4. **チャットメッセージは左右に美しく配置される**

## 🔧 開発者向け情報

### 環境変数
| 変数名 | 説明 | 必須 |
|--------|------|------|
| `SECRET_KEY` | Django秘密キー | ✓ |
| `DEBUG` | デバッグモード | - |
| `DIFY_API_URL` | Dify APIエンドポイント | ✓ |
| `DIFY_API_KEY` | Dify APIキー | ✓ |

### 時間情報抽出
AIの回答から以下の正規表現パターンで時間情報を抽出：
```python
time_pattern = r'参考箇所: \[(\d{1,2}:\d{2})-(\d{1,2}:\d{2})\]'
```

例：`参考箇所: [4:44-5:33]` → 4分44秒から5分33秒の区間

### APIエンドポイント
- `GET /` - メインページ
- `POST /chat/` - チャットAPI

## 🐛 トラブルシューティング

### 動画ファイルが読み込まれない
- `chat_app/static/chat_app/lecture.mp4` に動画ファイルが配置されているか確認
- ファイル形式が対応形式（MP4）であることを確認
- Django開発サーバーが動画ファイルを正しく配信しているか確認

### チャットボットが応答しない
- `.env` ファイルで `DIFY_API_KEY` が正しく設定されているか確認
- Dify APIサービスが利用可能であることを確認

### 環境変数が読み込まれない
- `.env` ファイルがプロジェクトルートに配置されているか確認
- `python-dotenv` がインストールされているか確認

## 🎨 デザイン仕様

### カラーパレット
- **プライマリ**: #3498db (青) - 再生ボタン、リンク
- **セカンダリ**: #e74c3c (赤) - 一時停止ボタン
- **成功**: #27ae60 (緑) - 送信ボタン
- **警告**: #f39c12 (オレンジ) - ローディング状態

### レスポンシブブレークポイント
- **デスクトップ (769px+)**: 左右分割レイアウト
- **タブレット (768px以下)**: 上下配置レイアウト
- **スマートフォン (575px以下)**: 単列レイアウト

## 🚀 パフォーマンス

- ✅ **高速レンダリング**: 最適化されたCSS
- ✅ **軽量**: 必要最小限のライブラリ使用
- ✅ **リアルタイム**: 音声制御とチャットの即座の連携
- ✅ **キャッシュ最適化**: 効率的な静的ファイル配信

## 📊 開発状況

**現在の状態**: **本番運用可能** 🎉

- ✅ **全機能完了**: 音声プレイヤー、チャット、連携機能
- ✅ **デザイン完了**: モダンで美しいUI/UX
- ✅ **セキュリティ対応**: 環境変数管理、CSRF対応
- ✅ **ドキュメント完備**: 完全な開発・運用ドキュメント

## 📄 ライセンス

このプロジェクトはMITライセンスの下で公開されています。

## 🤝 コントリビューション

プルリクエストやイシューの投稿を歓迎します。大きな変更を行う前に、まずイシューを作成して議論することをお勧めします。

## 📞 サポート

質問や問題がある場合は、GitHubのIssuesページでお知らせください。

---

**🎓 Django特許制度学習アプリ - 完全機能・美しいデザイン・本番運用可能**